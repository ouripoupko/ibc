<!DOCTYPE html>
<body>

 <section>
  <h1>Put contract</h1>
  <form>
   <input type="file" id="contractsrcfile">
   <pre>
    <textarea rows="8" cols="50" id="contractoutput"></textarea>
   </pre>
   <button type = "button" onclick="send_contract()" >Submit</button>
  </form>
  <p id="contract_result"></p>
  <script type="text/javascript">
   document.getElementById('contractsrcfile').addEventListener('change', function() {
     var fr=new FileReader();
     fr.onload=function(){
       document.getElementById('contractoutput').textContent=fr.result;
     }
     fr.readAsText(this.files[0]);
   })
  </script> 
  <script>
    function send_contract(){
      var xhr = new XMLHttpRequest();
      xhr.open("PUT", "/contract/", true);
      xhr.setRequestHeader('Content-Type', 'application/json');
      var pathparts = document.getElementById('contractsrcfile').value.split('\\');
      var names = pathparts[pathparts.length-1].split('.');
      xhr.send(JSON.stringify({'code': document.getElementById('contractoutput').textContent, 'name': names[0]}));

      xhr.onreadystatechange = function () {
        if (this.readyState != 4) return;
        if (this.status == 200) {
          var data = JSON.parse(this.responseText);
          document.getElementById('contract_result').textContent = JSON.stringify(data);
        }
      };
    }
  </script>
 </section>
 <section>
  <h1>Post contract</h1>
  <form>
   <label for="post_from">From:</label>
   <input type="number" id="post_from"/>
   <label for="post_to">To:</label>
   <input type="number" id="post_to"/>
   <label for="post_contract">Contract:</label>
   <select id="post_contract">
    <option>CSR</option>
   </select>
   <label for="post_trigger">Trigger:</label>
   <select id="post_trigger">
    <option>addMember</option>
    <option>triggerEdge</option>
   </select>
   <label for="post_params">Parameters dictionary:</label>
   <input type="text" id="post_params"/>
   <button type = "button" onclick="call_contract()" >Submit</button>
  </form>
  <p id="post_result"></p>
  <script>
    function call_contract(){
      var xhr = new XMLHttpRequest();
      xhr.open("POST", "/contract/", true);
      xhr.setRequestHeader('Content-Type', 'application/json');
      var msg = JSON.stringify({
        'from': document.getElementById('post_from').value,
        'to': document.getElementById('post_to').value,
        'msg': {
          'name': document.getElementById('post_contract').value,
          'method': document.getElementById('post_trigger').value,
          'param': JSON.parse(document.getElementById('post_params').value)
        }
      });
      console.log(msg);
      xhr.send(msg);

      xhr.onreadystatechange = function () {
        if (this.readyState != 4) return;
        if (this.status == 200) {
          var data = JSON.parse(this.responseText);
          document.getElementById('post_result').textContent = JSON.stringify(data);
        }
      };
    }
  </script>
 </section>
</body>
</html>
