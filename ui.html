<!DOCTYPE html>
<html>
 <body>

  <section>
   <h1>Put contract</h1>
   <form>
    <input type="file" id="contractsrcfile">
    <pre>
     <textarea rows="8" cols="50" id="contractoutput"></textarea>
    </pre>
    <button type = "button" onclick="send_contract()" >Submit</button>
   </form>
   <p id="contract_result"></p>
   <script type="text/javascript">
    document.getElementById('contractsrcfile').addEventListener('change', function() {
      var fr=new FileReader();
      fr.onload=function(){
        document.getElementById('contractoutput').textContent=fr.result;
      }
      fr.readAsText(this.files[0]);
    })
   </script>
   <script>
     function send_contract(){
       var xhr = new XMLHttpRequest();
       xhr.open("PUT", "/contract/", true);
       xhr.setRequestHeader('Content-Type', 'application/json');
       var pathparts = document.getElementById('contractsrcfile').value.split('\\');
       var names = pathparts[pathparts.length-1].split('.');
       xhr.send(JSON.stringify({'contract': names[0], 'msg': document.getElementById('contractoutput').textContent}));

       xhr.onreadystatechange = function () {
         if (this.readyState != 4) return;
         if (this.status == 200) {
           var data = JSON.parse(this.responseText);
           document.getElementById('contract_result').textContent = JSON.stringify(data);
         }
       };
     }
   </script>
  </section>
  <section>
   <h1>Post contract</h1>
   <form>
    <label for="post_contract">Contract:</label>
    <select id="post_contract">
     <option>Bank</option>
     <option>CSR</option>
    </select>
    <label for="post_trigger">Trigger:</label>
    <select id="post_trigger">
     <option>create</option>
     <option>pay</option>
     <option>addMember</option>
     <option>triggerEdge</option>
    </select>
    <label for="post_params">Parameters dictionary:</label>
    <select id="post_params">
     <option>{"pid":"5001"}</option>
     <option>{"from_pid":"5001", "to_pid":"5002", "amount":"37"}</option>
     <option>{"id":"5001"}</option>
    </select>
    <button type = "button" onclick="call_contract()" >Submit</button>
   </form>
   <p id="post_result"></p>
   <script>
     function call_contract(){
       var xhr = new XMLHttpRequest();
       xhr.open("POST", "/contract/", true);
       xhr.setRequestHeader('Content-Type', 'application/json');
       var msg = JSON.stringify({
         'from': '',
         'contract': document.getElementById('post_contract').value,
         'msg': {
           'method': document.getElementById('post_trigger').value,
           'param': JSON.parse(document.getElementById('post_params').value)
         }
       });
       console.log(msg);
       xhr.send(msg);

       xhr.onreadystatechange = function () {
         if (this.readyState != 4) return;
         if (this.status == 200) {
           var data = JSON.parse(this.responseText);
           document.getElementById('post_result').textContent = JSON.stringify(data);
         }
       };
     }
   </script>
  </section>
  <section>
   <h1>Put partner</h1>
   <form>
    <label for="partner_id">Partner ID:</label>
    <select id="partner_id">
     <option>5001</option>
    </select>
    <label for="partner_contract_id">Contract:</label>
    <select id="partner_contract_id">
     <option>CSR</option>
    </select>
    <button type = "button" onclick="put_partner()" >Submit</button>
   </form>
   <p id="partner_result"></p>
   <script>
     function put_partner(){
       var xhr = new XMLHttpRequest();
       xhr.open("PUT", "/partner/", true);
       xhr.setRequestHeader('Content-Type', 'application/json');
       var port = document.getElementById('partner_id').value;
       var contract = document.getElementById('partner_contract_id').value;
       var msg = JSON.stringify({'contract': contract, 'msg':{'address':'http://localhost:'.concat(port).concat('/'), 'id': port}});
       console.log(msg);
       xhr.send(msg);

       xhr.onreadystatechange = function () {
         if (this.readyState != 4) return;
         if (this.status == 200) {
           var data = JSON.parse(this.responseText);
           document.getElementById('partner_result').textContent = JSON.stringify(data);
         }
       };
     }
   </script>
  </section>
 </body>
</html>
